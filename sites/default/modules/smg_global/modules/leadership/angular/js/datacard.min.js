!function(){"use strict";var e=angular.module("dataCard",["ngSanitize","smgGaEvent"]);e.factory("delayFactory",["$timeout","$rootScope",function(e,t){var o={timers:{}};return o.getTimer=function(t){if(angular.isUndefined(o.timers[t])){o.timers[t]={timer:!1};var i=6500*parseInt(t);e(function(){o.timers[t].timer=!0},i)}return o.timers[t]},o}]),e.controller("DataCardCtrl",["$scope","$attrs","$timeout","gaEventWrapper",function(e,t,o,i){if(e.nid=t.nid,e.tid=t.tid,e.site=t.site,angular.isUndefined(t.delayVideoCompile)||(e.delayVideoCompile=t.delayVideoCompile),e.photos=[],e.parentHover=!1,e.dataCardHover=!1,Drupal.settings.hasOwnProperty("leadershipDatacard")&&Drupal.settings.leadershipDatacard.hasOwnProperty(e.tid))for(var r in Drupal.settings.leadershipDatacard[e.tid])if(Drupal.settings.leadershipDatacard[e.tid][r].datacard_nid==e.nid){var a=Drupal.settings.leadershipDatacard[e.tid][r],n=a.data_card_processed_for_angular;if(e.contactPhotoPath=!!n.hasOwnProperty("contact_photo_path")&&n.contact_photo_path,e.contactName=n.hasOwnProperty("contact_name")?n.contact_name:"",e.contactTitle=n.hasOwnProperty("contact_title")?n.contact_title:"",e.companyLogoPath=!!n.hasOwnProperty("company_logo_path")&&n.company_logo_path,e.companyWebsite=a.hasOwnProperty("company_website")?a.company_website:"",e.productSummary=n.hasOwnProperty("product_summary")?n.product_summary:"",e.companyName=a.hasOwnProperty("title")?a.title:"",e.teaser=n.hasOwnProperty("teaser")?n.teaser:"",n.hasOwnProperty("product_photos")&&n.product_photos.length>0)for(var s=0;s<n.product_photos.length;s++){var c=n.product_photos[s],d={url:c.hasOwnProperty("product_photo")?c.product_photo:"",link:c.hasOwnProperty("product_link")?c.product_link:"",title:c.hasOwnProperty("product_title")?c.product_title:""};e.photos.push(d)}e.printProfileNid=a.hasOwnProperty("print_profile_nid")?a.print_profile_nid:"",e.companyNid=a.hasOwnProperty("nid")?a.nid:"#",e.companyHasPmgYoutubeFeedVideos=!1,a.pmg_youtube_feed_videos.hasOwnProperty(e.companyNid)&&a.pmg_youtube_feed_videos[e.companyNid].hasOwnProperty("videos")&&(e.companyHasPmgYoutubeFeedVideos=!0);break}e.gaEvent=function(e,t,o,r){return i.gaEvent(e,t,o,r)},e.$on("leadershipHoverBegin",function(){e.parentHover=!0,e.$digest()}),e.$on("leadershipHoverEnd",function(){e.parentHover=!1,e.$digest()}),e.contactShowComma=function(){return e.contactName.length>0&&e.contactTitle.length>0?",":""},e.setParentHoverFalse=function(){e.parentHover=!1}}]),e.factory("hoverManage",["$window","$timeout",function(e,t){function o(e,t,o){var i=e[0];this.element=i,this.handler=o,this.scope=t,this.timer=!1,this.timerEnd=!1,this.leadershipLink=e.find(".leadership-link"),i.addEventListener("mouseover",this,!1)}o.prototype.globalValues={activeHover:!1,isActiveHover:!1},o.prototype.handleEvent=function(e){switch(e.type){case"mouseover":this.mouseOver(e);break;case"mouseleave":this.mouseLeave(e);break;case"mousemove":this.mouseMove(e)}},o.prototype.waitForMouseStop=function(e,t,o){function i(){a.element.removeEventListener("mousemove",a,!1),o()}function r(e){e=e||window.evt,a.timer&&window.clearTimeout(a.timer),a.timer=window.setTimeout(function(){i(e)},t)}var a=this;r(e)},o.prototype.mouseMove=function(e){var t=jQuery(this.element);this.mouseMoveXPrevious=!!this.hasOwnProperty("mouseMoveX")&&this.mouseMoveX,this.mouseMoveYPrevious=!!this.hasOwnProperty("mouseMoveY")&&this.mouseMoveY,this.mouseMoveX=void 0==e.offsetX?t.offset().left:e.offsetX,this.mouseMoveY=void 0==e.offsetY?t.offset().top:e.offsetY;var o=this;if(this.mouseMoveXPrevious&&this.mouseMoveXPrevious){var i=this.mouseMoveXPrevious-this.mouseMoveX,r=Math.abs(i),a=r>0?500:50;this.waitForMouseStop(e,a,function(){o.startHover()})}},o.prototype.startHover=function(){var e=this;this.firstHoverOccured=!0;var t=function(){e.globalValues.activeHover=e,e.globalValues.isActiveHover=!0,e.scope.broadcastHoverBegin()},o=this.globalValues.activeHover;o&&(o.instanceId!=this.instanceId||this.globalValues.isActiveHover)?o.instanceId!=this.instanceId&&(o.endHover(),t()):t()},o.prototype.mouseOver=function(e){var t=this.leadershipLink.position().left+this.leadershipLink.width(),o=jQuery(this.element),i=void 0==e.offsetX?e.pageX-o.offset().left:e.offsetX;i<t+20&&i>-4&&(this.element.addEventListener("mousemove",this,!1),this.element.addEventListener("mouseleave",this,!1))},o.prototype.mouseLeave=function(e){var t=this;this.timer&&window.clearTimeout(this.timer),this.timerEnd=window.setTimeout(function(){t.endHover()},300)},o.prototype.endHover=function(){this.timerEnd&&window.clearTimeout(this.timerEnd),this.globalValues.isActiveHover=!1,this.scope.broadcastHoverEnd(),this.element.removeEventListener("mouseleave",this,!1),this.element.removeEventListener("mousemove",this,!1)},o.prototype.lightboxOpened=function(){this.element.removeEventListener("mouseleave",this,!1),this.element.removeEventListener("mousemove",this,!1)};var i=0;return function(e,t,r){var a=new o(e,t,r);return a.instanceId=i,i++,a}}]),e.controller("leadershipLinkCtrl",["$scope","$rootScope","hoverManage",function(e,t,o){e.hoverOn=!1,e.broadcastHoverBegin=function(){e.$broadcast("leadershipHoverBegin",{}),e.hoverOn=!0},e.broadcastHoverEnd=function(){e.$broadcast("leadershipHoverEnd",{}),e.hoverOn=!1},e.startHoverManage=function(t){var i=void 0;i=o(t,this,function(){}),e.hoverManager=i},e.$on("smgLightboxOpen",function(t){e.hoverManager.lightboxOpened()})}]),e.directive("leadershipLink",[function(){return{restrict:"A",scope:!0,controller:"leadershipLinkCtrl",link:function(e,t,o){e.startHoverManage(t),t.find("a.leadership-link").each(function(t,o){var i=jQuery(o);i.hasClass("touchstart-off")||i.addClass("touchstart-off"),i.on("touchstart",function(t){i.hasClass("touchstart-off")?(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),i.addClass("touchstart-begin").removeClass("touchstart-off"),e.broadcastHoverBegin()):window.location.href=i.attr("href")})})}}}]),e.directive("leadershipDataCard",["$window","$timeout","delayFactory",function(e,t,o){var i=Drupal.settings.smgAngularTemplates.dataCard;return{restrict:"E",replace:!0,scope:!0,controller:"DataCardCtrl",link:function(i,r){i.currentDataCardHover=!1,i.compileVideo=angular.isUndefined(i.delayVideoCompile)?{timer:!0}:o.getTimer(i.delayVideoCompile),r.on({mouseenter:function(){i.dataCardHover=!0},mouseleave:function(){i.dataCardHover=!1}}),i.getDistanceToBottom=function(t){var o=angular.element(e).scrollTop(),i=t.offset().top,r=i-o,a=angular.element(e).height(),n=a-r;return n},i.checkTouchEvent=function(e){var t=r[0].getBoundingClientRect();if(jQuery(e.target).hasClass("touchstart-begin"))return!1;var o=e.pageY-jQuery(window).scrollTop();o<=t.bottom&&o>=t.top&&e.pageX<=t.right&&e.pageX>=t.left?i.currentDataCardHover=!0:(i.currentDataCardHover=!1,i.$apply())};var a=function(){var t=angular.element(e).width();return"ppoem"==!i.site||t>900?t>500?"534px":"90%":.58*t+"px"};i.$watch("compileVideo.timer",function(e){e&&t(function(){var e=["companyWebsite","companyLogoPath","contactPhotoPath","companyHasPmgYoutubeFeedVideos","compileVideo.timer"];i.$$watchers.forEach(function(t,o){e.indexOf(t.exp)>-1&&i.$$watchers.splice(o,1)})})}),i.$watch("parentHover",function(){if(i.parentHover){var e=a(),t="-50%";r.css({visibility:"hidden"}),r.css({width:e,display:"block"});var o=r.outerHeight();if(r.find(".videoWidget").length||r.find("compile-video-widget").length){var n=r.find(".videoWidget");n.find(".videoWidget-video").width()||(o=r.find(".dataCard-top").outerHeight()+245)}var s=i.getDistanceToBottom(r.parent()),c=function(){var e=r.parent().outerHeight(!0),t=i.getDistanceToBottom(r),o=t-s;return o+.5*e};o+10>s&&(t=(o-s+20)*-1,t+="px"),r.css({top:t,visibility:"visible"});var d=c(),u=r.find(".dataCard-after-arrow");parseInt(d)>o-20?u.css({display:"none"}):(u.css({display:"block"}),i.currentDataCardHover=!0,document.addEventListener("touchstart",i.checkTouchEvent,!0)),u.css({top:d})}else i.dataCardHover||(r.css({display:""}),i.currentDataCardHover=!1)}),i.$watch("dataCardHover",function(){i.dataCardHover||i.parentHover||r.css({display:""})}),i.$watch("currentDataCardHover",function(){i.currentDataCardHover||(document.removeEventListener("touchstart",i.checkTouchEvent,!0),r.css({display:""}),i.setParentHoverFalse(),r.siblings(".touchstart-begin").each(function(e,t){jQuery(t).removeClass("touchstart-begin").addClass("touchstart-off")}),r.siblings(".link-section").each(function(e,t){jQuery(t).find("a.leadership-link").removeClass("touchstart-begin").addClass("touchstart-off")}))})},templateUrl:i}}]),e.directive("compileDataCard",["$compile",function(e){return{restrict:"E",scope:{nid:"@",tid:"@",site:"@"},replace:!0,link:function(t,o,i){t.interpValues={interpNid:!1,interpTid:!1,interpSite:!1},i.$observe("nid",function(e){t.interpValues.interpNid=e}),i.$observe("tid",function(e){t.interpValues.interpTid=e}),i.$observe("site",function(e){t.interpValues.interpSite=e});var r=t.$watchCollection("interpValues",function(i){if(i.interpTid&&i.interpTid&&i.interpSite){var a=angular.element('<leadership-data-card nid="'+t.nid+'" tid="'+t.tid+'" site="'+t.site+'"></leadership-data-card>'),n=e(a)(t);o.replaceWith(n),r()}})}}}]),e.directive("compileVideoWidget",["$compile","$window",function(e,t){return{restrict:"E",scope:{nid:"@",tid:"@",hover:"=",compileVideoWidget:"="},replace:!0,link:function(o,i){var r=angular.element(t),a=!1;angular.isUndefined(o.compileVideoWidget)&&(o.compileVideoWidget=!0);var n=function(){var t=angular.element('<video-widget datacard="true" nid="'+o.nid+'" tid="'+o.tid+'" ></video-widget>');if(r.width()>480){var n=e(t)(o);i.replaceWith(n),a=!0}},s=function(){o.$$watchers=[]},c=o.$watch("hover",function(e){e&&!a&&(n(),c(),s())}),d=o.$watch("compileVideoWidget",function(e){e&&!a&&(n(),d(),s())})}}}]),e.directive("smgAnchorGaEvent",[function(){return{restrict:"A",link:function(e,t,o){angular.element(t).click(function(e){e.preventDefault(),e.stopPropagation()})}}}]),window.smgAngularDependencies.push("dataCard")}();